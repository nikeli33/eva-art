<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVA AI Art Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'logi-dark': '#1e053a', // –û—á–µ–Ω—å —Ç–µ–º–Ω—ã–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π (–¥–ª—è —Ñ–æ–Ω–∞ body)
                        'logi-card': 'rgba(64, 20, 102, 0.7)',
                        'logi-accent': '#c4b5fd', // –ë–æ–ª–µ–µ —Å–≤–µ—Ç–ª—ã–π –∏ —è—Ä–∫–∏–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –∞–∫—Ü–µ–Ω—Ç
                        'logi-header-bg': 'rgba(46, 10, 80, 0.8)', // –§–æ–Ω –¥–ª—è —Ö–µ–¥–µ—Ä–∞
                        'bubble-active': '#9333ea', // –Ø—Ä–∫–∏–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ "–ø—É–∑—ã—Ä—å–∫–∞"
                        'bubble-glow': 'rgba(196, 181, 253, 0.7)', // –°–≤–µ—Ç—è—â–∏–π—Å—è —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥–ª—è —Ç–µ–Ω–∏
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <script type="module" src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* –°—Ç–∏–ª—å –¥–ª—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ —Ñ–æ–Ω–∞, –∏–º–∏—Ç–∏—Ä—É—é—â–∏–π –Ω–µ–æ–Ω–æ–≤—ã–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π */
        body {
            background-image: 
                linear-gradient(rgba(30, 5, 58, 0.99), rgba(30, 5, 58, 0.9)), /* logi-dark #1e053a —Å 70% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é */
                url("AISamurai.png"); /* 2. –í–¢–û–†–û–ô –°–õ–û–ô: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
            background-position: center; /* Center the image */
            /*    background-repeat: no-repeat; */
            background-size: cover; /* Resize the background image to cover the entire container */
            /*    background: linear-gradient(135deg, #1e053a 0%, #3a0f75 50%, #1e053a 100%);*/
            min-height: 100vh;
            color: white;
            padding-bottom: 5rem; /* –û—Ç—Å—Ç—É–ø –¥–ª—è –Ω–∏–∂–Ω–µ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        }
        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–æ—Å—ã –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ WebKit */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e053a;
        }
        ::-webkit-scrollbar-thumb {
            background: #a78bfa;
            border-radius: 10px;
        }
        
        .neon-shadow {
            box-shadow: 0 0 8px rgba(167, 139, 250, 0.4), 0 4px 10px rgba(0, 0, 0, 0.4); 
        }

        .active-style {
            border: 3px solid #c4b5fd; /* logi-accent border */
            box-shadow: 0 0 15px rgba(196, 181, 253, 0.8), 0 0 30px rgba(147, 51, 234, 0.6); 
            transform: scale(1.05);
            transition: all 0.2s ease-in-out;
        }

        .style-card:not(.active-style):hover {
            box-shadow: 0 0 10px rgba(196, 181, 253, 0.7), 0 0 20px rgba(147, 51, 234, 0.5); 
            transform: scale(1.05);
            transition: all 0.2s ease-in-out;
        }
        
        .neon-hover:hover {
            box-shadow: 0 0 10px rgba(196, 181, 253, 0.7), 0 0 20px rgba(147, 51, 234, 0.5); 
            transform: scale(1.05);
        }
        
        .style-card-container {
            overflow: visible !important; 
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞–≤–±–∞—Ä–∞ */
        .nav-bg {
            background: rgba(30, 5, 58, 0.9);
            border-top: 1px solid rgba(196, 181, 253, 0.3);
            backdrop-filter: blur(8px);
        }
        
        .nav-item {
            color: white;
            padding: 4px 0;
        }
        .nav-item.active {
            color: #c4b5fd; /* logi-accent */
        }
        
        #bubble {
            background: linear-gradient(45deg, #9333ea, #c4b5fd);
            box-shadow: 0 0 15px #c4b5fd, 0 0 25px #9333ea;
            border: 1px solid #c4b5fd;
            border-radius: 12px;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content-img {
            max-width: 90%;
            max-height: 70vh;
            border-radius: 12px;
            object-fit: contain;
            box-shadow: 0 0 30px rgba(196, 181, 253, 0.8);
        }
        .close-button {
            position: absolute;
            top: 20px;
            right: 35px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: #c4b5fd;
            text-decoration: none;
            cursor: pointer;
        }
        
        /* üî• NEW: –°—Ç–∏–ª—å –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞, —á—Ç–æ–±—ã –≤–º–µ—Å—Ç–∏—Ç—å —Ç–µ–∫—Å—Ç */
        .modal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 90%;
            max-height: 90%;
        }

        /* –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è */
        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 12px;
            background: linear-gradient(90deg, rgba(196,181,253,1), rgba(147,51,234,1));
            color: #1e053a;
            font-weight: 600;
            box-shadow: 0 6px 18px rgba(147,51,234,0.25);
            text-decoration: none;
            margin-top: 0.5rem;
        }
        .download-btn:hover { transform: translateY(-2px); }

    </style>
</head>
<body class="font-sans antialiased">

    <header class="sticky top-0 z-50 p-4 bg-logi-header-bg backdrop-blur-sm shadow-xl">
        <div class="flex justify-between items-center max-w-lg mx-auto">
            <button class="text-white hover:text-logi-accent transition">
                <i data-lucide="menu" class="w-7 h-7"></i>
            </button>
            
            <h1 class="text-2xl font-extrabold tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-logi-accent">
                EVA.art
            </h1>
            
            <button class="text-white hover:text-logi-accent transition">
                <i data-lucide="bell" class="w-7 h-7"></i>
            </button>
        </div>
    </header>

    <main class="p-4 space-y-8 max-w-lg mx-auto">
        
        <div data-content="generate" class="page-content space-y-8">
            <section>
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-xl font-bold text-white">–í–≤–µ–¥–∏—Ç–µ –ü—Ä–æ–º–ø—Ç</h2>
                    <a href="#" class="text-logi-accent hover:text-pink-400 transition text-sm font-medium">–ü–æ–∏—Å–∫</a>
                </div>
                
                <div class="relative bg-logi-card p-4 rounded-2xl shadow-lg border border-purple-700/50 neon-shadow">
                    <textarea 
                        id="promptInput"
                        class="w-full h-28 bg-transparent text-white placeholder-purple-300/70 resize-none focus:outline-none"
                        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: '–ö–∏—Ç–∞—è–Ω–∫–∞ –≤ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–º –∫—Ä–∞—Å–Ω–æ–º –ø–ª–∞—Ç—å–µ —Ä—è–¥–æ–º —Å –≤–µ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –∫—Ä–∞—Å–Ω—ã–º –¥—Ä–∞–∫–æ–Ω–æ–º.'"
                    ></textarea>
                    <button id="generateButton" onclick="generateImage()" class="w-full mt-3 p-3 text-lg font-semibold rounded-xl bg-logi-accent hover:bg-logi-accent/90 text-logi-dark transition neon-shadow">
                        –°–æ–∑–¥–∞—Ç—å –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    </button>
                </div>
            </section>

            <section>
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-white">–°—Ç–∏–ª—å –ê—Ä—Ç–∞</h2>
                    <a href="#" class="text-logi-accent hover:text-pink-400 transition text-sm font-medium">–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ</a>
                </div>
                
                <div id="artStyleContainer" class="style-card-container flex gap-4 overflow-x-auto pb-4 scroll-smooth">
                    <div data-style="none" class="style-card flex-shrink-0 w-24 h-24 rounded-xl overflow-hidden bg-logi-card/80 flex flex-col items-center justify-center p-2 text-center border-2 border-transparent transition cursor-pointer active-style neon-shadow" onclick="selectStyle(this, '–ë–µ–∑ –°—Ç–∏–ª—è')">
                        <i data-lucide="ban" class="w-8 h-8 text-pink-400 mb-1"></i>
                        <span class="text-xs font-semibold">–ë–µ–∑ –°—Ç–∏–ª—è</span>
                    </div>

                    <div data-style="anime" class="style-card flex-shrink-0 w-24 h-24 rounded-xl overflow-hidden border-2 border-transparent transition cursor-pointer neon-shadow" onclick="selectStyle(this, '–ê–Ω–∏–º–µ')">
                        <img src="https://raw.githubusercontent.com/nikeli33/telegra-ph-images/refs/heads/main/images/imgenegrato/anime.png" alt="Anime Style" class="w-full h-full object-cover rounded-xl" onerror="this.onerror=null; this.src='https://placehold.co/128x128/4c2f88/fff?text=Anime';" />
                    </div>

                    <div data-style="fantasy" class="style-card flex-shrink-0 w-24 h-24 rounded-xl overflow-hidden border-2 border-transparent transition cursor-pointer neon-shadow" onclick="selectStyle(this, '–§—ç–Ω—Ç–µ–∑–∏')">
                        <img src="https://raw.githubusercontent.com/nikeli33/telegra-ph-images/refs/heads/main/images/imgenegrato/phsntasy.png" alt="Fantasy Style" class="w-full h-full object-cover rounded-xl" onerror="this.onerror=null; this.src='https://placehold.co/128x128/6a0f49/fff?text=Fantasy';" />
                    </div>

                    <div data-style="cityscape" class="style-card flex-shrink-0 w-24 h-24 rounded-xl overflow-hidden border-2 border-transparent transition cursor-pointer neon-shadow" onclick="selectStyle(this, '–ö–∏–±–µ—Ä–ø–∞–Ω–∫')">
                        <img src="https://raw.githubusercontent.com/nikeli33/telegra-ph-images/refs/heads/main/images/imgenegrato/cyberpunk.png" alt="Cityscape Style" class="w-full h-full object-cover rounded-xl" onerror="this.onerror=null; this.src='https://placehold.co/128x128/1a5276/fff?text=City';" />
                    </div>
                </div>
                <input type="hidden" id="selectedStyle" value="–ë–µ–∑ –°—Ç–∏–ª—è">
            </section>
            
            <section>
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-white">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h2>
                    <a href="#" class="text-logi-accent hover:text-pink-400 transition text-sm font-medium" 
                        onclick="navigate(document.querySelector('[data-item=\'gallery\']'), 'gallery'); event.preventDefault();">
                        –ü–µ—Ä–µ–π—Ç–∏ –≤ –ì–∞–ª–µ—Ä–µ—é
                    </a>
                </div>
                
                <div id="latestImagesContainer" class="grid grid-cols-2 gap-4 min-h-[160px]">
                    <div class="w-full h-32 col-span-2 flex items-center justify-center text-logi-accent/80 font-semibold rounded-xl bg-purple-900/50">
                        –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö...
                    </div>
                </div>
            </section>

        </div>
        
        <div data-content="gallery" class="page-content hidden">
             <h2 class="text-3xl font-bold text-white mb-6 pt-4">–ú–æ—è –ì–∞–ª–µ—Ä–µ—è</h2>
            <div id="fullImageGallery" class="grid grid-cols-2 gap-4 min-h-[250px]">
                <div class="w-full h-32 col-span-2 flex items-center justify-center text-logi-accent/80 font-semibold rounded-xl bg-purple-900/50">
                    –ó–∞–≥—Ä—É–∑–∫–∞ –≥–∞–ª–µ—Ä–µ–∏...
                </div>
            </div>
        </div>
        
        <div data-content="profile" class="page-content hidden">
            <h2 class="text-3xl font-bold text-white mb-6 pt-4">–ü—Ä–æ—Ñ–∏–ª—å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
            <div class="bg-logi-card p-6 rounded-2xl space-y-4 neon-shadow">
                <p class="text-lg">–í–∞—à –±–∞–ª–∞–Ω—Å: <span class="text-bubble-active font-bold">150 –ö—Ä–µ–¥–∏—Ç–æ–≤</span></p>
                <p class="text-sm text-purple-300">–ü–ª–∞–Ω: –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π</p>
                <button class="w-full mt-3 p-3 text-md font-semibold rounded-xl bg-pink-500 hover:bg-pink-600 text-white transition">
                    –ü–æ–ø–æ–ª–Ω–∏—Ç—å –ö—Ä–µ–¥–∏—Ç—ã
                </button>
            </div>
        </div>
        
        <div data-content="settings" class="page-content hidden">
            <h2 class="text-3xl font-bold text-white mb-6 pt-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
            <div class="bg-logi-card p-6 rounded-2xl space-y-4 neon-shadow">
                <div class="flex justify-between items-center border-b border-purple-600/50 pb-2">
                    <span class="text-md">–¢–µ–º–Ω—ã–π —Ä–µ–∂–∏–º</span>
                    <input type="checkbox" checked class="h-6 w-6 rounded text-pink-500 focus:ring-pink-500 bg-gray-700 border-gray-600">
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-md">–Ø–∑—ã–∫</span>
                    <span class="text-logi-accent">–†—É—Å—Å–∫–∏–π</span>
                </div>
            </div>
        </div>
        
        <div id="messageBox" class="fixed inset-x-0 bottom-24 mx-auto w-11/12 max-w-xs p-4 bg-yellow-500 text-gray-900 rounded-lg shadow-2xl text-center transition-opacity duration-300 opacity-0 pointer-events-none z-50">
            –°–æ–æ–±—â–µ–Ω–∏–µ
        </div>

    </main>
    
    <div id="imageModal" class="modal">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <div class="modal-content">
            <img class="modal-content-img mb-4" id="modalImage">
            <div id="modalPrompt" class="bg-logi-card p-4 rounded-xl max-w-full text-sm text-center"></div>
            <!-- –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è -->
            <a id="downloadButton" href="#" class="download-btn" title="–°–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                <i data-lucide="download-cloud" class="w-4 h-4"></i>
                <span>–°–∫–∞—á–∞—Ç—å</span>
            </a>
        </div>
    </div>
    
    <nav class="fixed bottom-0 left-0 right-0 z-50 p-3 nav-bg shadow-2xl">
        <div class="relative flex justify-around items-center h-12 max-w-lg mx-auto" id="navContainer">
            <div id="bubble" class="absolute h-full rounded-xl bg-gradient-to-r from-pink-500 to-bubble-active transition-all duration-300 ease-in-out"></div>

            <button data-item="generate" class="nav-item flex flex-col items-center text-sm font-medium transition duration-300 relative z-10 w-1/4 active" onclick="navigate(this, 'generate')">
                <i data-lucide="sparkles" class="w-6 h-6"></i>
                <span class="text-xs hidden sm:inline">–°–æ–∑–¥–∞—Ç—å</span>
            </button>
            
            <button data-item="gallery" class="nav-item flex flex-col items-center text-sm font-medium transition duration-300 relative z-10 w-1/4" onclick="navigate(this, 'gallery')">
                <i data-lucide="image" class="w-6 h-6"></i>
                <span class="text-xs hidden sm:inline">–ì–∞–ª–µ—Ä–µ—è</span>
            </button>
            
            <button data-item="profile" class="nav-item flex flex-col items-center text-sm font-medium transition duration-300 relative z-10 w-1/4" onclick="navigate(this, 'profile')">
                <i data-lucide="user" class="w-6 h-6"></i>
                <span class="text-xs hidden sm:inline">–ü—Ä–æ—Ñ–∏–ª—å</span>
            </button>
            
            <button data-item="settings" class="nav-item flex flex-col items-center text-sm font-medium transition duration-300 relative z-10 w-1/4" onclick="navigate(this, 'settings')">
                <i data-lucide="settings" class="w-6 h-6"></i>
                <span class="text-xs hidden sm:inline">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </button>
        </div>
    </nav>


    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏
        const navItems = document.querySelectorAll('.nav-item');
        const pageContents = document.querySelectorAll('.page-content');
        const generateButton = document.getElementById('generateButton');
        let currentActiveItem = null;

        // üí° –í–ê–ñ–ù–û: –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–ò –ê–î–†–ï–°–ê –ù–ê –í–ê–®–ò –ê–î–†–ï–°–ê –í–ï–ë–•–£–ö–û–í N8N!
        const GENERATE_WEBHOOK_URL = 'https://n8n.eva-dragon.ru/webhook/imagegen'; 
        const GALLERY_WEBHOOK_URL = 'https://n8n.eva-dragon.ru/webhook/get-galery'; 
        // --------------------------------------------------

        // --------------------------------------------------
        // –õ–û–ì–ò–ö–ê –ù–ê–í–ë–ê–†–ê –ò UI
        // --------------------------------------------------

        function updateBubblePosition(activeItem) {
            const bubble = document.getElementById('bubble');
            const navContainer = document.getElementById('navContainer');
            
            if (!bubble || !navContainer || !activeItem) return;

            const rect = activeItem.getBoundingClientRect();
            const containerRect = navContainer.getBoundingClientRect();
            
            const left = rect.left - containerRect.left;
            const width = rect.width;
            
            bubble.style.left = `${left}px`;
            bubble.style.width = `${width}px`;
            bubble.style.top = '0px'; 
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function navigate(clickedItem, contentId) {
            if (currentActiveItem && clickedItem === currentActiveItem) {
                // –ï—Å–ª–∏ –Ω–∞–∂–∏–º–∞–µ–º –Ω–∞ –≥–∞–ª–µ—Ä–µ—é, –∫–æ–≥–¥–∞ –æ–Ω–∞ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–∞, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –µ—ë
                if (contentId === 'gallery') {
                    fetchAllImages();
                }
                return;
            }

            navItems.forEach(item => item.classList.remove('active'));
            clickedItem.classList.add('active');
            
            updateBubblePosition(clickedItem);

            pageContents.forEach(content => {
                if (content.getAttribute('data-content') === contentId) {
                    content.classList.remove('hidden');
                } else {
                    content.classList.add('hidden');
                }
            });

            currentActiveItem = clickedItem;
            
            // –ï—Å–ª–∏ –ø–µ—Ä–µ—à–ª–∏ –≤ –≥–∞–ª–µ—Ä–µ—é, –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            if (contentId === 'gallery') {
                fetchAllImages(); 
            }
        }
        
        function initNavbar() {
            if (!navItems.length) return;
            
            currentActiveItem = document.querySelector('.nav-item.active') || navItems[0];
            
            updateBubblePosition(currentActiveItem);

            window.addEventListener('resize', () => {
                if (window.resizeTimer) clearTimeout(window.resizeTimer);
                window.resizeTimer = setTimeout(() => {
                    updateBubblePosition(currentActiveItem);
                }, 100);
            });
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
            fetchLatestImages();
        }
        
        /**
         * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ alert()
         */
        function showMessage(text, isError = false) {
            const messageBox = document.getElementById('messageBox');
            
            messageBox.classList.remove('bg-yellow-500', 'bg-red-500', 'bg-green-500');
            
            if (isError) {
                messageBox.classList.add('bg-red-500');
            } else if (text.includes("–ì–æ—Ç–æ–≤–æ!")) {
                 messageBox.classList.add('bg-green-500');
            } else {
                messageBox.classList.add('bg-yellow-500');
            }

            messageBox.textContent = text;
            messageBox.classList.remove('opacity-0', 'pointer-events-none');
            
            setTimeout(() => {
                messageBox.classList.add('opacity-0', 'pointer-events-none');
            }, 3000);
        }

        function selectStyle(element, styleName) {
            const styleCards = document.querySelectorAll('.style-card');
            const selectedStyleInput = document.getElementById('selectedStyle');

            styleCards.forEach(card => {
                card.classList.remove('active-style');
            });

            element.classList.add('active-style');
            selectedStyleInput.value = styleName;

            showMessage(`–í—ã–±—Ä–∞–Ω —Å—Ç–∏–ª—å: ${styleName}`);
        }
        
        // --- –õ–æ–≥–∏–∫–∞ –ú–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ ---
        function openModal(imageUrl, promptText) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalPrompt = document.getElementById('modalPrompt'); // üî• –ù–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
            const downloadButton = document.getElementById('downloadButton');

            modalImage.src = imageUrl;
            modalImage.alt = promptText || "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ";
            modalPrompt.textContent = promptText || "–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è (–ø—Ä–æ–º–ø—Ç–∞)"; // üî• –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–æ–º–ø—Ç

            // –§–æ—Ä–º–∏—Ä—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
            const filename = sanitizeFilename((promptText || 'image')) + '.png';

            // –°–æ—Ö—Ä–∞–Ω–∏–º –¥–∞–Ω–Ω—ã–µ –≤ dataset –¥–ª—è –∫–Ω–æ–ø–∫–∏
            downloadButton.dataset.imageUrl = imageUrl;
            downloadButton.dataset.filename = filename;

            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —è–∫–æ—Ä—è ‚Äî —Å–∫–∞—á–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ JS
            downloadButton.onclick = function (e) {
                e.preventDefault();
                const url = this.dataset.imageUrl;
                const name = this.dataset.filename || 'image.png';
                downloadImage(url, name);
            };

            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
        }
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        document.getElementById('imageModal').addEventListener('click', (e) => {
            if (e.target.id === 'imageModal') {
                closeModal();
            }
        });

        // –£—Ç–∏–ª–∏—Ç–∞ ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
        function sanitizeFilename(name) {
            return name
                .toString()
                .normalize('NFKD')
                .replace(/\s+/g, '_')
                .replace(/[^a-zA-Z0-9_\-\.]/g, '')
                .slice(0, 60);
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ø–æ–ø—ã—Ç–∫–∞ fetch -> blob, –∏–Ω–∞—á–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ)
        async function downloadImage(url, filename) {
            try {
                const response = await fetch(url, {mode: 'cors'});
                if (!response.ok) throw new Error('Network response was not ok');
                const blob = await response.blob();
                const blobUrl = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = blobUrl;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                a.remove();
                URL.revokeObjectURL(blobUrl);
            } catch (err) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å —á–µ—Ä–µ–∑ fetch, –æ—Ç–∫—Ä–æ–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ:', err);
                // –§–æ–ª–±—ç–∫: –æ—Ç–∫—Ä–æ–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é
                window.open(url, '_blank');
            }
        }

        // --------------------------------------------------
        // –õ–û–ì–ò–ö–ê –ì–ê–õ–ï–†–ï–ò: –ó–ê–ì–†–£–ó–ö–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô –ò–ó –ë–î
        // --------------------------------------------------

        /**
         * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML-—Ä–∞–∑–º–µ—Ç–∫—É –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
         */
        function createImageCard(image) {
            // ‚≠ê –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–æ–¥—ã n8n.
            // –ï—Å–ª–∏ –Ω–æ–¥–∞ Respond to Webhook –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç { image_url: '...', russian_prompt: '...' }
            const imageUrl = image.image_url; 
            const promptText = image.russian_prompt || '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'; 

            if (!imageUrl) return ''; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º, –µ—Å–ª–∏ —Å—Å—ã–ª–∫–∏ –Ω–µ—Ç

            // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–≤—ã—á–µ–∫ –≤ –ø—Ä–æ–º–ø—Ç–µ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ onclick
            const safePrompt = promptText.replace(/'/g, "\\'").replace(/\"/g, '\\"');

            return `
                <div class="w-full aspect-square rounded-xl overflow-hidden shadow-xl bg-purple-900/50 transition cursor-pointer neon-hover neon-shadow"
                    onclick="openModal('${imageUrl}', '${safePrompt}')">
                    <img src="${imageUrl}" 
                        alt="${promptText}" 
                        title="${promptText}"
                        class="w-full h-full object-cover">
                </div>
            `;
        }

        /**
         * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
         */
        async function fetchImages(containerId, endpointUrl, limit) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∑–∞–≥–ª—É—à–∫—É (Loader)
            container.innerHTML = `
                <div class="w-full h-32 col-span-2 flex items-center justify-center text-logi-accent/80 font-semibold rounded-xl bg-purple-900/50">
                    –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...
                </div>
            `;
            
            try {
                const response = await fetch(`${endpointUrl}?limit=${limit}`, { 
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status} ${response.statusText}`);
                }

                let images = await response.json(); 
                
                const imagesArray = Array.isArray(images) && images.length > 0 && Array.isArray(images[0]) 
                    ? images[0] : (Array.isArray(images) ? images : (images ? [images] : []));

                const finalImages = imagesArray.flatMap(item => item.json || item);


                if (finalImages.length > 0) {
                    const html = finalImages.map(createImageCard).join('');
                    container.innerHTML = html;
                } else {
                    container.innerHTML = `
                        <div class="w-full h-32 col-span-2 flex items-center justify-center text-purple-400 font-medium">
                            –ì–∞–ª–µ—Ä–µ—è –ø—É—Å—Ç–∞. –ù–∞—á–Ω–∏—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é!
                        </div>
                    `;
                }
            } catch (error) {
                console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ ${endpointUrl}:`, error);
                container.innerHTML = `
                    <div class="w-full h-32 col-span-2 flex items-center justify-center text-red-400 font-medium">
                        –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∞–ª–µ—Ä–µ–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Webhook –∏ SQL-–∑–∞–ø—Ä–æ—Å.
                    </div>
                `;
            }
        }
        
        // 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ª—å–∫–æ 4 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —Å–µ–∫—Ü–∏–∏ "Generate"
        function fetchLatestImages() {
            fetchImages('latestImagesContainer', GALLERY_WEBHOOK_URL, 4);
        }

        // 2. –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —Å–µ–∫—Ü–∏–∏ "Gallery"
        function fetchAllImages() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º 50 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏
            fetchImages('fullImageGallery', GALLERY_WEBHOOK_URL, 50); 
        }


        // --------------------------------------------------
        // –õ–û–ì–ò–ö–ê –ì–ï–ù–ï–†–ê–¶–ò–ò
        // --------------------------------------------------

        async function generateImage() {
            const prompt = document.getElementById('promptInput').value;
            const style = document.getElementById('selectedStyle').value;

            if (prompt.trim() === "") {
                showMessage("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.", true);
                return;
            }
            
            // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
            generateButton.disabled = true;
            generateButton.innerHTML = '<i data-lucide="loader-2" class="w-5 h-5 animate-spin inline-block mr-2"></i> –ì–µ–Ω–µ—Ä–∞—Ü–∏—è... –ü–æ–¥–æ–∂–¥–∏—Ç–µ ‚è≥';
            if (typeof lucide !== 'undefined') lucide.createIcons(); // –û–±–Ω–æ–≤–∏—Ç—å –∏–∫–æ–Ω–∫—É, –µ—Å–ª–∏ lucide –¥–æ—Å—Ç—É–ø–µ–Ω
            generateButton.classList.add('opacity-70');
            showMessage(`–ó–∞–ø—Ä–æ—Å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –°—Ç–∏–ª—å: ${style}.`);

            const payload = {
                russian_prompt: prompt,
                art_style: style
            };

            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é (–º–µ—Ç–æ–¥ POST)
                const response = await fetch(GENERATE_WEBHOOK_URL, {
                    method: 'POST', // –≠—Ç–æ—Ç Webhook –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ POST
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                if (response.ok) {
                    
                    showMessage("‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ì–æ—Ç–æ–≤–æ! –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –≥–∞–ª–µ—Ä–µ–µ.", false);
                    
                    // ‚≠ê –ö–ª—é—á–µ–≤–æ–π —à–∞–≥: –æ–±–Ω–æ–≤–ª—è–µ–º –≥–∞–ª–µ—Ä–µ–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
                    fetchLatestImages(); 
                    // –ï—Å–ª–∏ –≥–∞–ª–µ—Ä–µ—è –æ—Ç–∫—Ä—ã—Ç–∞, –æ–±–Ω–æ–≤–∏–º –∏ –µ–µ
                    if (document.querySelector('[data-content="gallery"]').classList.contains('hidden') === false) {
                        fetchAllImages();
                    }
                    
                    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–º–ø—Ç–∞
                    document.getElementById('promptInput').value = ''; 
                    
                } else {
                    const errorText = await response.text();
                    showMessage(`‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${response.status} ${response.statusText}`, true);
                    console.error("Webhook Error:", response.status, response.statusText, errorText);
                }
            } catch (error) {
                console.error("Fetch error:", error);
                showMessage("‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ n8n.", true);
            } finally {
                // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏
                generateButton.disabled = false;
                generateButton.textContent = '–°–æ–∑–¥–∞—Ç—å –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ';
                generateButton.classList.remove('opacity-70');
            }
        }

        // --------------------------------------------------
        // –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        // --------------------------------------------------

        document.addEventListener('DOMContentLoaded', () => {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            initNavbar();
        });

    </script>
</body>
</html>
